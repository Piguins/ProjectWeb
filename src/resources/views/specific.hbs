<ul class="specific-nav" style="z-index: 10001; display:none" id="specific-nav">
  <li>
    <a aria-current="page" href="#img-part">Ảnh</a>
  </li>

  <li>
    <a href="#detail-part">Chi tiết</a>
  </li>
  <li>
    <a href="#convenience-part">Tiện nghi</a>
  </li>
  <li>
    <a href="#comment-part">Đánh giá</a>
  </li>
  <li>
    <a href="#host-part">Chủ nhà</a>
  </li>

</ul>

<div class="specific-container">
  <div class="specific-container-name">
    <div class="name">{{data.name}}</div>
    <div class="wishLish">
      <button data-bs-roomId={{data._id}} data-bs-toggle="modal" data-bs-target="#wishlist"><i class="bi bi-heart"></i>
        Lưu
      </button>

      <button><i class="fa fa-solid fa-share"></i>Chia sẻ</button>
    </div>
  </div>

  <div class="specific-container-img" id="img-part">

    <div class="specific-container-img-some">
      <div class="img1" type="button" data-bs-toggle="modal" data-bs-target="#love"> {{#with img.[0]}}
        <img class="" src="{{this}}"> {{/with}}
      </div>
      <div class="img2" type="button" data-bs-toggle="modal" data-bs-target="#love"> {{#with img.[1]}}
        <img src="{{this}}"> {{/with}}
      </div>
      <div class="img3" type="button" data-bs-toggle="modal" data-bs-target="#love"> {{#with img.[2]}}
        <img src="{{this}}"> {{/with}}
      </div>
      <div class="img4" type="button" data-bs-toggle="modal" data-bs-target="#love"> {{#with img.[3]}}
        <img src="{{this}}"> {{/with}}
      </div>
      <div class="img5" type="button" data-bs-toggle="modal" data-bs-target="#love"> {{#with img.[4]}}
        <img src="{{this}}"> {{/with}}
      </div>
      <div class="show">
        <button class="btn btn-light" data-bs-toggle="modal" data-bs-target="#love">:::Xem tất cả các
          ảnh</button>
      </div>
    </div>


  </div>


  <div class="float-container" id="detail-part">
    <div class="specific-container-detail">
      <div class="specific-container-detail-host">
        <h2>Toàn bộ nhà</h2>

      </div>
      <div class="specific-container-detail-house">
        <p>
          {{data.maximuncus}} khách tối đa . {{data.bed}} phòng ngủ . {{data.shower}} nhà tắm
        </p>
      </div>


      <hr>
      <h3>Nơi này có gì cho bạn</h3>
      <div class="row d-flex justify-content-start align-items-center h-100 w-100 p-3">
              <p class="col-6"><i class="bi bi-wifi ms-2"></i> {{item.value}}</p>
        <p class="col-6"><i class="bi bi-wifi ms-2"></i> Wi-fi</p>
        <p class="col-6"><i class="bi bi-p-circle ms-2"></i> Chỗ đỗ xe miễn phí tại nơi ở</p>
        <p class="col-6"><i class="bi bi-water ms-2"></i> Bể bơi</p>
        <p class="col-6"><i class="bi bi-tv ms-2"></i> TV</p>
        <p class="col-6"><i class=" fa fa-solid fa-vest-patches ms-2"></i> Máy sấy quần áo</p>
        <p class="col-6"><i class="fa-sharp fa-light fa fa-snowflake ms-2"></i> Điều hòa nhiệt độ</p>
        <p class="col-6"><i class="fa fa-solid fa-shower ms-2"></i> Bồn tắm</p>
        <p class="col-6"><i class="fa-solid fa fa-suitcase ms-2"></i> Cho phép gửi hành lý</p>
        <p class="col-6"><i class="fa fa-solid fa-wind ms-2"></i> Máy phát hiện khí CO</p>



      </div>

    </div>
    <hr>
    <div class="specific-container-payment" id="payment">
      <form method="post" action="/rooms/payment" class="w-75">
        <div class="reservate-info" style="display:none">
          <input type="text" name="roomId" value={{data._id}}>
          <input type="text" name="hostId" value={{data.host._id}}>
          <input type="number" name="days" value="0" id="day">
        </div>
        <div class="specific-container-payment-price">
          <p>${{data.price}}/đêm</p>

        </div>
        <div class="specific-container-payment-inputday">
          <div class="specific-container-payment-inputday-start">
            <label for="datepicker">Ngày nhận phòng</label>
            <input type="date" name="startday" id="datepicker2" autocomplete="off" max={{ genTime
              data.endday "YYYY-MM-DD" }} min={{ genTime data.startday "YYYY-MM-DD" }}>

          </div>
          <div class="specific-container-payment-inputday-end">
            <label for="datepicker2">Ngày trả phòng</label>
            <input type="date" name="endday" id="datepicker5" max={{genTime data.endday "YYYY-MM-DD" }} min={{genTime
              data.startday "YYYY-MM-DD" }} autocomplete="off">

          </div>
        </div>
        <hr>

        <div class="specific-container-payment-inputnumber">
          <label for="datepicker2">Số lượng khách
            <input type="number" name="cc" id="datepicker3" value="1" autocomplete="off" max="{{data.maximuncus}}"
              min="1">
          </label>
        </div>
        <div class="specific-container-payment-inputsubmit">
          <input type="submit" value="Đặt phòng" />
        </div>
        <p>Bạn vẫn chưa bị trừ tiền</p>
        <div class="specific-container-payment-fee">

          <div class="extracost">
            <p>Phí vệ sinh 8$</p>
          </div>
          <div class="fiatcost">
            <p>Phí dịch vụ $</p>
            <input type="number" readonly value={{extracost data.price}}>
          </div>
          <div class="realcost">
            <label for="finalcost">Tổng chi phí trước thuế :$ </label>
            <input type="number" id="finalcost" name="final" readonly value="0" </div>
          </div>
        </div>
      </form>
    </div>

  </div>




  <div class="specific-container-host" id="comment-part">


    <div class="container py-5 h-100">
      <div class="row d-flex justify-content-start align-items-center h-100">
        <h3>Đánh giá</h3>
        {{#if wish}}
        {{else}} <p class="fw-bolg ml-2"> Chưa có đánh giá</p>
        {{/if}}
        {{#each wish}}
        <div class="col-8 p-4 grid2 ">

          <div style="height: 200px; border-radius:20px ;" class="w-100 bg-light  p-4">
            <p class="w-100 h-75 overflow-hidden">

              {{this.value}}
            </p>
            <div class="w-100 h-25 d-flex flex-column flex-wrap">
              <div class="w-25 h-100">
                <img class="w-100 h-100 rounded-circle" src="{{this.owner.avatar}}">
              </div>
              <div class="w-75 h-50  d-flex justify-content-center">
                {{this.owner.fullName}}
              </div>
              <div class="w-75 h-50 d-flex justify-content-center">
                <p class="t"> {{genTime this.createdAt 'MMMM Do YYYY'}} </p>
              </div>




            </div>

          </div>
          {{/each }}
        </div>
      </div>

    </div>

  </div>
  {{#if isOwner}}
  {{else}}
  <div class="specific-container-host w-75" id="host-part">


    <div class="container py-5 h-100 ">
      <div class="row d-flex justify-content-start align-items-center h-100 p-3">
        <div class="col-8">
          <div class="card p-2" style="border-radius: 15px;">
            <div class="card-head">
              <div class="card-title mx-auto p-2">
                Thông tin chủ nhà
              </div>
            </div>
            <div class="card-body p-4">
              <div class="d-flex text-black">
                <div class="flex-shrink-0">
                 <a href="/user/personaldetail/{{data.host._id}}"><img src="{{data.host.avatar}}" class="img-fluid"
                    style="width: 180px; border-radius: 10px;" /></a> 
                </div>
                <div class="flex-grow-1 ms-3 ">
                  <h5 class="mb-1">{{data.host.fullName}}</h5>
                  <div class="mb-2 pb-1 row d-flex flex-row" style="color: #2b2a2a;">
                    <p><i class="fa fa-solid fa-mask"></i> Đã xác minh danh tính </p>
                    <p> Tham gia vào tháng {{genTime
                      data.host.created_at 'MMMM YYYY'}}</p>
                  </div>

                  <div class="d-flex  justify-content-start rounded-3 p-2 mb-3" style="background-color: #efefef;">
                    <div>
                      <p class="small text-muted mb-1">
                        Articles
                      </p>
                      <p class="mb-0">41</p>
                    </div>
                    <div class="px-3">
                      <p class="small text-muted mb-1">
                        Lượt theo dõi
                      </p>
                      <p class="mb-0">976</p>
                    </div>
                    <div>
                      <p class="small text-muted mb-1">
                        {{conversationId}}
                      </p>
                      <p class="mb-0">8.5</p>
                    </div>
                  </div>
                  <div class="align-seft-center">
                    {{#if islogged}}
                    <form action="/user/message/{{conversationId}}" method="get">
                      <input type="text" name="cus" value="{{id}}" style="display: none;">
                      <input type="text" name="host" value="{{data.host._id}}" style="display: none;">

                      <input class="btn btn-primary" type="submit" value="chat to this host">
                    </form>

                    {{else}}
                    <a class="dropdown-item btn btn-info text-center w-50 align-self-center text-uppercase"
                      href="/login" role="button">
                      chat
                    </a>
                    {{/if}}

                  </div>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {{/if}}
</div>
<hr>
</div>
<div class="modal fade" id="love" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-fullscreen ">
    <div class="modal-content">
      <div class="modal-header">

        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="carouselExample" class="carousel slide bg-dark">
          <div class="carousel-inner " id="resultsBox">

            {{#each data.img}}
            <div class="carousel-item">
              <img class="d-block w-50 h-75 rounded-4" src="/img/post/{{this}}">
            </div>

            {{/each}}
            <div class="carousel-item active"> {{#with img.[0]}}
              <img class="d-block w-80 h-75" src="/img/post/{{this}}"> {{/with}}
            </div>

          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>

    </div>
  </div>
</div>

<div class="modal fade" id="wishlist" aria-hidden="true" aria-labelledby="exampleModalToggleLabel" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalToggleLabel">Danh sách Yêu thích của bạn</h5>

        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

        {{#each wish}}
        <form action="/user/wishlist/update/{{this._id}}" method="post">
          <input id="roomId" name="roomId" style="display: none;">
          <input style="display: none;" name="collectionId" value={{this.room}}>
          <button id={{this._id}} style="width:100%" class="btn btn-outline-light border border-light my-2 text-start"
            type="submit">{{this.name}}</button>

        </form>
        {{/each}} <button class="btn btn-light" data-bs-target="#collection" data-bs-toggle="modal"
          data-bs-dismiss="modal">+</button>
        <button class="btn btn-light" data-bs-target="#collection" data-bs-toggle="modal" data-bs-dismiss="modal">Tạo
          danh sách mong muốn mới</button>
      </div>
      <div class="modal-footer">

      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="collection" aria-hidden="true" aria-labelledby="exampleModalToggleLabel2" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalToggleLabel2"> Đặt tên cho danh sách mong muốn này</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

        <form action="/user/wishlist/collection" method="post">
          <label for="name"></label>
          <input name="name" type="text"></input>
          <input class="btn btn-dark" type="submit" value="Tạo">
        </form>
      </div>

    </div>
  </div>
</div>
<div class="offcanvas offcanvas-end  " data-bs-backdrop="false" tabindex="-1"
  style="z-index: 100000; width:400px !important ,height:50%,min-height:400px,min-width:300px" id="messageOffcanvas"
  aria-labelledby="offcanvasExampleLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title fw-light" id="offcanvasExampleLabel">{{data.host.fullName}}</h5>
    </h5>

    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body w-100 position-relative h-100">
    <section style="background-color: #eee; " class="w-100 h-100">
      <div class="container  w-100 h-100">

        <div class=" w-100  h-100 position-relative">





          <form id="msgForm" action="" class="h-100 position-relative">
            <div class="w-100  h-75 " style="overflow-y: scroll;" id="messageBox"></div>
            <input class=" position-absolute bottom-0 start-0 w-75 rounded-5" id="msg" type="text" name="msg" value="">
            <input class="" style="display:none" id="hostId" type="text" name="msg" value="{{data.host._id}}">

            <input class="" style="display:none" id="cusId" type="text" name="msg" value="{{id}}">
            <input class="btn btn-danger w-25  position-absolute bottom-0 end-0 " type="submit" id="submitbtn"
              value="send">
          </form>
          <div id="messages">



            </ul>


          </div>

        </div>
    </section>


  </div>

</div>
<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();

  const chartForm = document.querySelector('#msgForm');

  chartForm.addEventListener("submit", function (e) {
    e.preventDefault();
    let mes = document.getElementById("msg").value;
    let host = document.getElementById("hostId").value;
    let cus = document.getElementById("cusId").value;
    $('#msg').val("");

    socket.emit('on-chat', {
      message: mes,
      host: host,
      cus: cus
    })



  })
  socket.on('user-chat', (message) => {
    let host = document.getElementById("hostId").value;
    let cus = document.getElementById("cusId").value;
    let textPos = "";
    let bg = "bg-secondary";
    if (message.cus === cus) {
      textPos = "end";
      bg = "bg-primary text-white";
    }
    var img = "<img src=\"/img/user/{{data.host.avatar}}\" class=\"rounded-circle d-flex align-self-" + textPos + "\" width=\"20\">";
    var card = "<div class=\"d-flex flex-column align-items-" + textPos + "\"><p class=\"fw-light fs mb-0 rounded-4\">{{data.host.fullName}}</p><div style=\" width:fit-content\" class=\" p-2  d-flex flex-row-reverse\">" + img + "<p class=\"mb-0 rounded-3 " + bg + "p-2\">" + message.message +
      "</p></div>"
    $('#messageBox').append(card);
  })

</script>
<script>
  $(document).ready(function () {



    var exampleModal = document.getElementById('wishlist')
    exampleModal.addEventListener('show.bs.modal', function (event) {

      // Button that triggered the modal
      var button = event.relatedTarget
      // Extract info from data-bs-* attributes
      var recipient = button.getAttribute('data-bs-roomId')

      // If necessary, you could initiate an AJAX request here
      // and then do the updating in a callback.

      // Update the modal's content.
      $("[id=roomId]").val(recipient);






    })

    var now = new Date();

    var day = ("0" + now.getDate()).slice(-2);
    var month = ("0" + (now.getMonth() + 1)).slice(-2);

    var today = now.getFullYear() + "-" + (month) + "-" + (day);

    $('#datepicker2').val(today);
    $('#datepicker5').val(today);

    var d1 = document.getElementById("datepicker5").value;
    var d2 = document.getElementById("datepicker2").value;
    const dateOne = new Date(d1);
    const dateTwo = new Date(d2);
    const time = Math.abs(dateTwo - dateOne);
    const days = Math.ceil(time / (1000 * 60 * 60 * 24));
    $("#day").val(days);
    $("#finalcost").val($("#datepicker3").val() * {{ data.price }} * days + 8 + {{ data.price }} * 0.2);

  var payment = $("#payment");
  var threshold = payment.offset().top;
  var host = $("#host-part");
  var threshold1 = payment.offset().top;
  console.log(threshold)
  $(window).on("scroll", function () {
    var currentScroll = $(this).scrollTop();

    if (currentScroll > threshold - 50) {

      if (currentScroll > threshold1 + screen.height) {
        payment.removeClass("fixed");
      }
      else {
        payment.addClass("fixed");
      }

    } else {
      payment.removeClass("fixed");

    }

    if (currentScroll > threshold) {

      $("#specific-nav").addClass("displayFlex");
    } else {

      $("#specific-nav").removeClass("displayFlex");
    }

  });

  $('#resultsBox li:first').addClass('active');

  $("#show").click(
    function () {
      $("#full").addClass("display1");
    }
  );
  $("#unshow").click(
    function () {
      $("#full").removeClass("display1");
    }
  );
  $("#datepicker3").change(function () {
    var d1 = document.getElementById("datepicker5").value;
    var d2 = document.getElementById("datepicker2").value;
    const dateOne = new Date(d1);
    const dateTwo = new Date(d2);
    const time = Math.abs(dateTwo - dateOne);
    const days = Math.ceil(time / (1000 * 60 * 60 * 24));
    $("#day").val(days);
    $("#finalcost").val($("#datepicker3").val() * {{ data.price }} * days + 8 + {{ data.price }} * 0.2);

  });
  $("#datepicker2").change(function () {
    var d1 = document.getElementById("datepicker5").value;
    var d2 = document.getElementById("datepicker2").value;
    const dateOne = new Date(d1);
    const dateTwo = new Date(d2);
    const time = Math.abs(dateTwo - dateOne);
    const days = Math.ceil(time / (1000 * 60 * 60 * 24));
    $("#day").val(days);
    $("#finalcost").val($("#datepicker3").val() * {{ data.price }} * days + 8 + {{ data.price }} * 0.2);

  });
  $("#datepicker5").change(function () {
    var d1 = document.getElementById("datepicker5").value;
    var d2 = document.getElementById("datepicker2").value;
    const dateOne = new Date(d1);
    const dateTwo = new Date(d2);
    const time = Math.abs(dateTwo - dateOne);
    const days = Math.ceil(time / (1000 * 60 * 60 * 24));
    $("#day").val(days);
    $("#finalcost").val($("#datepicker3").val() * {{ data.price }} * days + 8 + {{ data.price }} * 0.2);

  });
  })
</script>